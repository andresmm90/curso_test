"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mostly from https://github.com/isaacs/server-destroy (which seems to be unmaintained)
function destroyable(server) {
    var connections = {};
    server.on('connection', function (conn) {
        var key = conn.remoteAddress + ':' + conn.remotePort;
        connections[key] = conn;
        conn.on('close', function () {
            delete connections[key];
        });
    });
    server.destroy = function () {
        return new Promise(function (resolve, reject) {
            server.close(function (err) {
                if (err)
                    reject(err);
                else
                    resolve();
            });
            for (var key in connections) {
                connections[key].destroy();
            }
        });
    };
    return server;
}
exports.default = destroyable;
